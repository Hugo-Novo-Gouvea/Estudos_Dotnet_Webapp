@page "/cliente/form" 
@page "/cliente/form/{id:int}"
@using GestaoClientes.Web.Models
@inject HttpClient Http
@inject NavigationManager Navigation

<PageTitle>Cadastro de Cliente</PageTitle>

<h3>@Titulo</h3> <EditForm Model="cliente" OnValidSubmit="SalvarCliente">
    <DataAnnotationsValidator />

    <div class="mb-3">
        <label>Nome:</label>
        <InputText @bind-Value="cliente.Nome" class="form-control" />
    </div>

    <div class="mb-3">
        <label>Email:</label>
        <InputText @bind-Value="cliente.Email" class="form-control" />
    </div>

    <div class="mb-3">
        <label>Telefone:</label>
        <InputText @bind-Value="cliente.Telefone" class="form-control" />
    </div>

    <div class="mb-3 form-check">
        <label class="form-check-label">
            <InputCheckbox @bind-Value="cliente.Ativo" class="form-check-input" />
            Cliente Ativo?
        </label>
    </div>

    <button type="submit" class="btn btn-success">Salvar</button>
    <button type="button" class="btn btn-secondary" @onclick="Voltar">Cancelar</button>
</EditForm>

@code {
    [Parameter]
    public int? Id { get; set; } // O ID vem da URL (pode ser nulo se for novo)

    private Cliente cliente = new Cliente();
    private string Titulo = "Novo Cliente";
    
    // URL da API (Ajuste a porta se necessário)
    private string ApiUrl = "http://localhost:5149/api/clientes"; 

    // 1. Ao iniciar a página
    protected override async Task OnInitializedAsync()
    {
        // Se tiver ID na URL, é EDIÇÃO. Busca os dados no banco.
        if (Id is not null)
        {
            Titulo = "Editar Cliente";
            // GET api/clientes/5
            cliente = await Http.GetFromJsonAsync<Cliente>($"{ApiUrl}/{Id}");
        }
    }

    // 2. Ao clicar em Salvar
    private async Task SalvarCliente()
    {
        if (Id is not null)
        {
            // --- LÓGICA DE ATUALIZAR (PUT) ---
            // PUT api/clientes/5
            await Http.PutAsJsonAsync($"{ApiUrl}/{Id}", cliente);
        }
        else
        {
            // --- LÓGICA DE CRIAR (POST) ---
            // POST api/clientes
            await Http.PostAsJsonAsync(ApiUrl, cliente);
        }

        // Depois de salvar, volta para a lista
        Navigation.NavigateTo("/");
    }

    private void Voltar()
    {
        Navigation.NavigateTo("/");
    }
}